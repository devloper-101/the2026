<!DOCTYPE html>
<html lang="en" class="grey">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One Last Marathon Before Sunset</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --border-color: #e5e7eb;
            --accent-color: #4f46e5;
            --accent-hover: #4338ca;
            --progress-bg: #e5e7eb;
            --chart-grid-color: rgba(0, 0, 0, 0.05);
        }

        html.slate {
            --bg-primary: #020617;
            --bg-secondary: #0f172a;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --border-color: #1e293b;
            --accent-color: #818cf8;
            --accent-hover: #a78bfa;
            --progress-bg: #1e293b;
            --chart-grid-color: rgba(255, 255, 255, 0.1);
        }

        html.grey {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --text-primary: #d1d5db;
            --text-secondary: #9ca3af;
            --border-color: #374151;
            --accent-color: #d1d5db;
            --accent-hover: #f9fafb;
            --progress-bg: #374151;
            --chart-grid-color: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        .plan-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        .progress-bar-container {
            background-color: var(--progress-bg);
            border-radius: 9999px;
            overflow: hidden;
            height: 1rem;
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
            background-image: linear-gradient(to right, var(--accent-color), var(--accent-hover));
        }

        .is-complete .progress-bar { animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 3px var(--accent-color); }
            50% { box-shadow: 0 0 15px var(--accent-hover); }
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0.25rem;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s;
        }
        .task-item:last-child { border-bottom: none; }
        .task-item:hover { background-color: var(--progress-bg); }
        
        .task-item input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            margin-right: 1rem;
            accent-color: var(--accent-color);
            flex-shrink: 0;
            cursor: pointer;
        }
        .task-item label {
            flex-grow: 1; cursor: pointer; transition: all 0.2s;
        }
        .task-item.completed label {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        /* Toast Notification */
        #toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 1.5rem;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 9999px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            transition: bottom 0.5s ease-in-out;
            z-index: 50;
        }
        #toast.show { bottom: 20px; }

        /* Reset Modal */
        #reset-modal {
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="relative container mx-auto p-4 sm:p-6 md:p-8">
        <div class="absolute top-0 left-0 p-4 sm:p-6 md:p-8">
       
        </div>
        <header class="relative text-center mb-6">
            <div class="absolute top-0 right-0">
                <button id="theme-toggle" class="p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] focus:ring-[var(--accent-color)]">
                    <svg id="theme-icon-sun" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 14.95a1 1 0 010-1.414l.707-.707a1 1 0 011.414 1.414l-.707.707a1 1 0 01-1.414 0zM5 11a1 1 0 100-2H4a1 1 0 100 2h1z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>
                    <svg id="theme-icon-moon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                </button>
            </div>
            <h1 id="greeting" class="text-xl sm:text-2xl text-[var(--text-secondary)]">Good Evening!</h1>
            <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-[var(--text-primary)]">One Last Marathon Before Sunset</h2>
        </header>
        
        <div id="quote-container" class="text-center mb-10 italic text-[var(--text-secondary)]"></div>

        <!-- Main Dashboard -->
        <section class="grid grid-cols-1 lg:grid-cols-5 gap-8 mb-12">
            <!-- Progress Section -->
            <div class="lg:col-span-2 plan-card p-6">
                <h2 class="text-2xl font-bold mb-6 text-center">Your Progress</h2>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-semibold text-lg">Overall Progress</h3>
                            <span id="overall-progress-text" class="font-bold text-[var(--accent-color)]">0%</span>
                        </div>
                        <div class="progress-bar-container h-4"><div id="overall-progress-bar" class="progress-bar h-full rounded-full"></div></div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-lg mt-6 mb-3">Subject-wise</h3>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between items-center mb-1"><span>Physics</span><span id="physics-progress-text" class="font-semibold">0%</span></div>
                                <div class="progress-bar-container"><div id="physics-progress-bar" class="progress-bar"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1"><span>Chemistry</span><span id="chemistry-progress-text" class="font-semibold">0%</span></div>
                                <div class="progress-bar-container"><div id="chemistry-progress-bar" class="progress-bar"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1"><span>Mathematics</span><span id="maths-progress-text" class="font-semibold">0%</span></div>
                                <div class="progress-bar-container"><div id="maths-progress-bar" class="progress-bar"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                 <div class="mt-8 text-center">
                    <button id="reset-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] focus:ring-red-500">
                        Reset Progress
                    </button>
                </div>
            </div>
            <!-- Analytics Section -->
            <div class="lg:col-span-3 plan-card p-6">
                 <h2 class="text-2xl font-bold mb-6 text-center">Your Analytics</h2>
                 <div class="h-48 md:h-56 mb-6"><canvas id="progressChart"></canvas></div>
                 <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                    <div class="p-4 bg-[var(--bg-primary)] rounded-lg">
                        <h4 class="text-md font-semibold text-[var(--text-secondary)]">Chapters Today</h4>
                        <p id="daily-improvement" class="text-3xl font-bold text-[var(--accent-color)]">0</p>
                    </div>
                     <div class="p-4 bg-[var(--bg-primary)] rounded-lg">
                        <h4 class="text-md font-semibold text-[var(--text-secondary)]">Chapters This Week</h4>
                        <p id="weekly-improvement" class="text-3xl font-bold text-[var(--accent-color)]">0</p>
                    </div>
                    <div class="p-4 bg-[var(--bg-primary)] rounded-lg">
                        <h4 class="text-md font-semibold text-[var(--text-secondary)]">Chapters Remaining</h4>
                        <p id="chapters-remaining" class="text-3xl font-bold text-[var(--accent-color)]">0</p>
                    </div>
                 </div>
            </div>
        </section>

        <!-- Checklist Section -->
        <section class="mb-12">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-8">Chapter Checklist</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                <div>
                    <h3 class="flex items-center text-xl font-bold mb-4 text-[var(--accent-color)]"><svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>A. PHYSICS</h3>
                    <div class="space-y-8 mt-4">
                        <div class="plan-card p-6">
                            <h4 class="font-semibold text-lg mb-4">Phase 1: Secure Boards</h4>
                            <div id="physics-tasks-phase1" class="checklist"></div>
                        </div>
                        <div class="plan-card p-6">
                            <h4 class="font-semibold text-lg mb-4">Phase 2: High-Impact JEE</h4>
                            <div id="physics-tasks-phase2" class="checklist"></div>
                        </div>
                    </div>
                </div>
                 <div>
                    <h3 class="flex items-center text-xl font-bold mb-4 text-[var(--accent-color)]"><svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>B. CHEMISTRY</h3>
                    <div class="space-y-8 mt-4">
                        <div class="plan-card p-6">
                            <h4 class="font-semibold text-lg mb-4">Phase 1: Master Class 12</h4>
                            <div id="chemistry-tasks-phase1" class="checklist"></div>
                        </div>
                        <div class="plan-card p-6">
                            <h4 class="font-semibold text-lg mb-4">Phase 2: High-Impact JEE</h4>
                            <div id="chemistry-tasks-phase2" class="checklist"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="flex items-center text-xl font-bold mb-4 text-[var(--accent-color)]"><svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3m0 0l3-3m-3 3v6m0-13a9 9 0 110 18 9 9 0 010-18z"></path></svg>C. MATHEMATICS</h3>
                     <div class="space-y-8 mt-4">
                        <div class="plan-card p-6">
                            <h4 class="font-semibold text-lg mb-4">Phase 1: Conquer Class 12</h4>
                            <div id="maths-tasks-phase1" class="checklist"></div>
                        </div>
                        <div class="plan-card p-6">
                            <h4 class="font-semibold text-lg mb-4">Phase 2: High-Impact JEE</h4>
                            <div id="maths-tasks-phase2" class="checklist"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Toast Notification -->
    <div id="toast"></div>
    
    <!-- Reset Modal -->
    <div id="reset-modal" class="fixed inset-0 z-40 items-center justify-center hidden">
        <div class="absolute inset-0 bg-black/60"></div>
        <div class="relative plan-card p-8 m-4 max-w-sm w-full text-center">
            <h3 class="text-2xl font-bold mb-4">Are you sure?</h3>
            <p class="text-[var(--text-secondary)] mb-6">All your progress will be permanently deleted. This action cannot be undone.</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-reset" class="py-2 px-6 rounded-lg bg-[var(--progress-bg)] hover:bg-[var(--border-color)] font-semibold transition-colors">Cancel</button>
                <button id="confirm-reset" class="py-2 px-6 rounded-lg bg-red-600 hover:bg-red-700 text-white font-semibold transition-colors">Confirm Reset</button>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {

    const tasks = {
        physics: {
            phase1: [ { id: 'phy-p1-1', text: 'Optics: Ray & Wave Optics' }, { id: 'phy-p1-2', text: 'Electrostatics & Current Electricity' }, { id: 'phy-p1-3', text: 'Magnetic Effects, EMI & AC' }, { id: 'phy-p1-4', text: 'Modern Physics (Dual Nature, Atoms, Nuclei)' }, { id: 'phy-p1-5', text: 'Electronic Devices (Semiconductors)' } ],
            phase2: [ { id: 'phy-p2-1', text: 'Thermodynamics' }, { id: 'phy-p2-2', text: 'Rotational Motion' }, { id: 'phy-p2-3', text: 'Work, Energy, and Power' }, { id: 'phy-p2-4', text: 'Kinematics' }, { id: 'phy-p2-5', text: 'Oscillations and Waves' } ]
        },
        chemistry: {
            phase1: [ { id: 'chem-p1-1', text: 'Electrochemistry, Solutions, Kinetics' }, { id: 'chem-p1-2', text: 'Coordination Compounds' }, { id: 'chem-p1-3', text: 'd- and f-Block Elements' }, { id: 'chem-p1-4', text: 'Aldehydes, Ketones, & Carboxylic Acids' }, { id: 'chem-p1-5', text: 'Alcohols, Phenols & Ethers' } ],
            phase2: [ { id: 'chem-p2-1', text: 'Chemical Bonding (Most Important)' }, { id: 'chem-p2-2', text: 'Mole Concept & Equilibrium' }, { id: 'chem-p2-3', text: 'General Organic Chemistry (GOC)' }, { id: 'chem-p2-4', text: 'Hydrocarbons' } ]
        },
        maths: {
            phase1: [ 
                { id: 'math-p1-1', text: 'Continuity & Differentiability' }, 
                { id: 'math-p1-2', text: 'Application of Derivatives' }, 
                { id: 'math-p1-3', text: 'Integrals' }, 
                { id: 'math-p1-4', text: 'Application of Integrals' }, 
                { id: 'math-p1-5', text: 'Differential Equations' },
                { id: 'math-p1-6', text: 'Vectors and 3D Geometry' }, 
                { id: 'math-p1-7', text: 'Matrices and Determinants' } 
            ],
            phase2: [ { id: 'math-p2-1', text: 'Coordinate Geometry (Lines, Circles, Conics)' }, { id: 'math-p2-2', text: 'Sequences and Series' }, { id: 'math-p2-3', text: 'Binomial Theorem, P&C' }, { id: 'math-p2-4', text: 'Probability' } ]
        }
    };
    const quotes = [
        "The secret to getting ahead is getting started.",
        "Success is the sum of small efforts, repeated day in and day out.",
        "Don't watch the clock; do what it does. Keep going.",
        "Believe you can and you're halfway there.",
        "The future depends on what you do today."
    ];
    
    const themes = ['light', 'slate', 'grey'];

    const greetingEl = document.getElementById('greeting');
    const quoteContainer = document.getElementById('quote-container');
    const toastEl = document.getElementById('toast');
    const chartCanvas = document.getElementById('progressChart');
    const resetModal = document.getElementById('reset-modal');
    let progressChart = null;
    
    function setGreeting() {
        const hour = new Date().getHours();
        greetingEl.textContent = hour < 12 ? 'Good Morning!' : hour < 18 ? 'Good Afternoon!' : 'Good Evening!';
    }
    
    function displayRandomQuote() {
        const randomIndex = Math.floor(Math.random() * quotes.length);
        quoteContainer.textContent = `"${quotes[randomIndex]}"`;
    }

    function createTaskElements() {
        for (const subject in tasks) {
            for (const phase in tasks[subject]) {
                const container = document.getElementById(`${subject}-tasks-${phase}`);
                if (container) {
                    tasks[subject][phase].forEach(task => {
                        const taskItem = document.createElement('div');
                        taskItem.classList.add('task-item');
                        taskItem.innerHTML = `<input type="checkbox" id="${task.id}" data-subject="${subject}"><label for="${task.id}">${task.text}</label>`;
                        container.appendChild(taskItem);
                    });
                }
            }
        }
    }

    function updateProgress() {
        let totalTasks = 0, completedTasks = 0;
        for (const subject in tasks) {
            const subjectCheckboxes = document.querySelectorAll(`input[data-subject="${subject}"]`);
            const subjectTotal = subjectCheckboxes.length;
            const subjectCompleted = Array.from(subjectCheckboxes).filter(cb => cb.checked).length;
            
            const percentage = subjectTotal > 0 ? (subjectCompleted / subjectTotal) * 100 : 0;
            const progressBar = document.getElementById(`${subject}-progress-bar`);
            const progressText = document.getElementById(`${subject}-progress-text`);
            
            if (progressBar) progressBar.style.width = `${percentage}%`;
            if (progressText) progressText.textContent = `${Math.round(percentage)}%`;

            totalTasks += subjectTotal;
            completedTasks += subjectCompleted;
        }
        
        const overallPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
        const overallProgressBar = document.getElementById('overall-progress-bar');
        const overallProgressText = document.getElementById('overall-progress-text');
        
        if(overallProgressBar) overallProgressBar.style.width = `${overallPercentage}%`;
        if(overallProgressText) overallProgressText.textContent = `${Math.round(overallPercentage)}%`;

        document.getElementById('chapters-remaining').textContent = totalTasks - completedTasks;
    }

    function saveProgress(checkboxId, isChecked) {
        const progress = JSON.parse(localStorage.getItem('studyPlanProgressV2')) || {};
        if (isChecked) {
             progress[checkboxId] = { completed: true, timestamp: new Date().toISOString() };
        } else {
            if(progress[checkboxId]) {
                 progress[checkboxId].completed = false;
            }
        }
        localStorage.setItem('studyPlanProgressV2', JSON.stringify(progress));
    }

    function loadProgress() {
        const savedProgress = JSON.parse(localStorage.getItem('studyPlanProgressV2'));
        if (savedProgress && Object.keys(savedProgress).length > 0) {
            for (const taskId in savedProgress) {
                const checkbox = document.getElementById(taskId);
                if (checkbox && savedProgress[taskId].completed) {
                    checkbox.checked = true;
                    checkbox.parentElement.classList.add('completed');
                }
            }
            showToast("Welcome back! We've loaded your progress.");
        }
    }
    
    function showToast(message) {
        toastEl.textContent = message;
        toastEl.classList.add('show');
        setTimeout(() => {
            toastEl.classList.remove('show');
        }, 3000);
    }

    function animateValue(obj, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerHTML = Math.floor(progress * (end - start) + start);
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    function updateAnalytics() {
        const savedProgress = JSON.parse(localStorage.getItem('studyPlanProgressV2')) || {};
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const sevenDaysAgo = new Date(today);
        sevenDaysAgo.setDate(today.getDate() - 6);

        let dailyCount = 0;
        let weeklyCount = 0;
        const weeklyData = Array(7).fill(0);
        const dayLabels = Array(7).fill(0).map((_, i) => {
            const d = new Date(today);
            d.setDate(today.getDate() - (6 - i));
            return d.toLocaleDateString('en-US', { weekday: 'short' });
        });

        for(const taskId in savedProgress) {
            const item = savedProgress[taskId];
            if(item.completed && item.timestamp) {
                const completedDate = new Date(item.timestamp);
                if (completedDate >= today) dailyCount++;
                if (completedDate >= sevenDaysAgo) {
                    weeklyCount++;
                    const diffDays = Math.floor((today - new Date(completedDate.getFullYear(), completedDate.getMonth(), completedDate.getDate())) / (1000 * 60 * 60 * 24));
                    if (diffDays >= 0 && diffDays < 7) {
                        weeklyData[6-diffDays]++;
                    }
                }
            }
        }
        
        animateValue(document.getElementById('daily-improvement'), 0, dailyCount, 500);
        animateValue(document.getElementById('weekly-improvement'), 0, weeklyCount, 500);
        renderChart(dayLabels, weeklyData);
    }
    
    function renderChart(labels, data) {
        if (progressChart) progressChart.destroy();
        const rootStyles = getComputedStyle(document.documentElement);
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = rootStyles.getPropertyValue('--text-secondary').trim();

        progressChart = new Chart(chartCanvas, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Chapters Completed', data: data,
                    backgroundColor: rootStyles.getPropertyValue('--accent-color').trim() + '33', // Add alpha
                    borderColor: rootStyles.getPropertyValue('--accent-color').trim(),
                    borderWidth: 2, tension: 0.4, fill: true,
                    pointBackgroundColor: rootStyles.getPropertyValue('--accent-hover').trim(), pointRadius: 5
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, ticks: { stepSize: 1 }, grid: { color: 'var(--chart-grid-color)' } },
                    x: { grid: { color: 'var(--chart-grid-color)' } }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    // Theme Management
    const themeToggle = document.getElementById('theme-toggle');
    const sunIcon = document.getElementById('theme-icon-sun');
    const moonIcon = document.getElementById('theme-icon-moon');
    
    function applyTheme(theme) {
        themes.forEach(t => document.documentElement.classList.remove(t));
        if (theme !== 'light') {
            document.documentElement.classList.add(theme);
        }
        const isDark = theme !== 'light';
        sunIcon.style.display = isDark ? 'none' : 'block';
        moonIcon.style.display = isDark ? 'block' : 'none';
        renderChartBasedOnCurrentData();
    }

    themeToggle.addEventListener('click', () => {
        const currentTheme = localStorage.getItem('theme') || 'light';
        const currentIndex = themes.indexOf(currentTheme);
        const nextIndex = (currentIndex + 1) % themes.length;
        const newTheme = themes[nextIndex];
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);
    });

    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme && themes.includes(savedTheme)) {
            applyTheme(savedTheme);
        } else {
            // Default to grey theme
            applyTheme('grey');
        }
    }

    function renderChartBasedOnCurrentData() {
        const savedProgress = JSON.parse(localStorage.getItem('studyPlanProgressV2')) || {};
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        
        const weeklyData = Array(7).fill(0);
        const dayLabels = Array(7).fill(0).map((_, i) => {
            const d = new Date(today);
            d.setDate(today.getDate() - (6 - i));
            return d.toLocaleDateString('en-US', { weekday: 'short' });
        });

        for(const taskId in savedProgress) {
            const item = savedProgress[taskId];
            if(item.completed && item.timestamp) {
                const completedDate = new Date(item.timestamp);
                const sevenDaysAgo = new Date(today);
                sevenDaysAgo.setDate(today.getDate() - 6);
                if (completedDate >= sevenDaysAgo) {
                    const diffDays = Math.floor((today - new Date(completedDate.getFullYear(), completedDate.getMonth(), completedDate.getDate())) / (1000 * 60 * 60 * 24));
                    if (diffDays >= 0 && diffDays < 7) {
                        weeklyData[6-diffDays]++;
                    }
                }
            }
        }
        renderChart(dayLabels, weeklyData);
    }

    // Event Listeners
    function addEventListeners() {
        document.querySelectorAll('.checklist input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                checkbox.parentElement.classList.toggle('completed', e.target.checked);
                saveProgress(checkbox.id, e.target.checked);
                updateProgress();
                updateAnalytics();
            });
        });

        document.getElementById('reset-button').addEventListener('click', () => {
            resetModal.classList.remove('hidden');
            resetModal.classList.add('flex');
        });
        document.getElementById('cancel-reset').addEventListener('click', () => {
            resetModal.classList.add('hidden');
            resetModal.classList.remove('flex');
        });
        document.getElementById('confirm-reset').addEventListener('click', () => {
            localStorage.removeItem('studyPlanProgressV2');
            location.reload();
        });
    }

    // Initial Setup
    setGreeting();
    displayRandomQuote();
    createTaskElements();
    loadProgress();
    updateProgress();
    initTheme(); 
    addEventListeners();
    updateAnalytics();
});
</script>

</body>
</html>

